<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯APIé›†æˆæµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        .price-display { font-size: 24px; font-weight: bold; color: #007bff; }
        .change-positive { color: #28a745; }
        .change-negative { color: #dc3545; }
    </style>
</head>
<body>
    <h1>ğŸš€ å‰ç«¯APIé›†æˆæµ‹è¯•</h1>
    
    <div class="test-section info">
        <h3>ğŸ“Š å®æ—¶ä»·æ ¼æ•°æ®</h3>
        <div id="ticker-result">åŠ è½½ä¸­...</div>
    </div>
    
    <div class="test-section info">
        <h3>ğŸ“ˆ ä»·æ ¼å›¾è¡¨æ•°æ®</h3>
        <div id="chart-result">åŠ è½½ä¸­...</div>
    </div>
    
    <div class="test-section info">
        <h3>ğŸ” å¸‚åœºæ•°æ®</h3>
        <div id="market-result">åŠ è½½ä¸­...</div>
    </div>
    
    <div class="test-section info">
        <h3>ğŸŒ å‰ç«¯é¡µé¢æµ‹è¯•</h3>
        <div id="frontend-result">åŠ è½½ä¸­...</div>
    </div>
    
    <script>
        async function testTickerAPI() {
            const resultDiv = document.getElementById('ticker-result');
            try {
                const response = await fetch('http://localhost:8000/market/ticker?symbol=BTC-USDT');
                const data = await response.json();
                
                if (data.success) {
                    const changeClass = data.data.changePercent24h >= 0 ? 'change-positive' : 'change-negative';
                    const changeIcon = data.data.changePercent24h >= 0 ? 'ğŸ“ˆ' : 'ğŸ“‰';
                    
                    resultDiv.innerHTML = `
                        <div class="price-display">$${data.data.last.toLocaleString()}</div>
                        <div class="${changeClass}">
                            ${changeIcon} ${(data.data.changePercent24h * 100).toFixed(2)}%
                        </div>
                        <div>24hæˆäº¤é‡: ${data.data.volume24h.toLocaleString()} BTC</div>
                        <div>æ›´æ–°æ—¶é—´: ${new Date(data.data.timestamp).toLocaleString()}</div>
                    `;
                    resultDiv.parentElement.className = 'test-section success';
                } else {
                    resultDiv.innerHTML = `âŒ APIè¿”å›å¤±è´¥: ${data.message}`;
                    resultDiv.parentElement.className = 'test-section error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ APIè°ƒç”¨å¤±è´¥: ${error.message}`;
                resultDiv.parentElement.className = 'test-section error';
            }
        }
        
        async function testChartAPI() {
            const resultDiv = document.getElementById('chart-result');
            try {
                const response = await fetch('http://localhost:8000/market/price-chart?symbol=BTC-USDT&timeframe=1H&limit=5');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div>âœ… è·å–åˆ° ${data.data.length} æ¡Kçº¿æ•°æ®</div>
                        <div>æœ€æ–°ä»·æ ¼: $${data.data[data.data.length - 1]?.price?.toLocaleString() || 'N/A'}</div>
                        <div>æ—¶é—´èŒƒå›´: ${data.data[0]?.time} - ${data.data[data.data.length - 1]?.time}</div>
                    `;
                    resultDiv.parentElement.className = 'test-section success';
                } else {
                    resultDiv.innerHTML = `âŒ APIè¿”å›å¤±è´¥: ${data.message}`;
                    resultDiv.parentElement.className = 'test-section error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ APIè°ƒç”¨å¤±è´¥: ${error.message}`;
                resultDiv.parentElement.className = 'test-section error';
            }
        }
        
        async function testMarketAPI() {
            const resultDiv = document.getElementById('market-result');
            try {
                const response = await fetch('http://localhost:8000/market/data?symbol=BTC-USDT&timeframe=1H&limit=3');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div>âœ… è·å–åˆ° ${data.data.length} æ¡å¸‚åœºæ•°æ®</div>
                        <div>æœ€æ–°æ”¶ç›˜ä»·: $${data.data[data.data.length - 1]?.close?.toLocaleString() || 'N/A'}</div>
                        <div>æ•°æ®å®Œæ•´æ€§: ${data.data.every(item => item.open && item.high && item.low && item.close) ? 'å®Œæ•´' : 'ä¸å®Œæ•´'}</div>
                    `;
                    resultDiv.parentElement.className = 'test-section success';
                } else {
                    resultDiv.innerHTML = `âŒ APIè¿”å›å¤±è´¥: ${data.message}`;
                    resultDiv.parentElement.className = 'test-section error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ APIè°ƒç”¨å¤±è´¥: ${error.message}`;
                resultDiv.parentElement.className = 'test-section error';
            }
        }
        
        async function testFrontendPage() {
            const resultDiv = document.getElementById('frontend-result');
            try {
                const response = await fetch('http://localhost:3000');
                if (response.ok) {
                    resultDiv.innerHTML = `
                        <div>âœ… å‰ç«¯é¡µé¢å¯è®¿é—®</div>
                        <div>çŠ¶æ€ç : ${response.status}</div>
                        <div>å†…å®¹ç±»å‹: ${response.headers.get('content-type')}</div>
                        <div><a href="http://localhost:3000" target="_blank">æ‰“å¼€å‰ç«¯é¡µé¢</a></div>
                    `;
                    resultDiv.parentElement.className = 'test-section success';
                } else {
                    resultDiv.innerHTML = `âŒ å‰ç«¯é¡µé¢è®¿é—®å¤±è´¥: HTTP ${response.status}`;
                    resultDiv.parentElement.className = 'test-section error';
                }
            } catch (error) {
                resultDiv.innerHTML = `âŒ å‰ç«¯é¡µé¢è®¿é—®å¤±è´¥: ${error.message}`;
                resultDiv.parentElement.className = 'test-section error';
            }
        }
        
        // æ‰§è¡Œæ‰€æœ‰æµ‹è¯•
        async function runAllTests() {
            console.log('ğŸš€ å¼€å§‹æ‰§è¡Œæ‰€æœ‰æµ‹è¯•...');
            await testTickerAPI();
            await testChartAPI();
            await testMarketAPI();
            await testFrontendPage();
            console.log('âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ');
        }
        
        // é¡µé¢åŠ è½½æ—¶æ‰§è¡Œæµ‹è¯•
        window.onload = runAllTests;
    </script>
</body>
</html>
