<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kçº¿å›¾è°ƒè¯•æµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #1a1a1a;
            color: white;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(26, 26, 26, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .chart-container {
            height: 400px;
            background: #222;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }
        .data-display {
            background: #333;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin: 10px 0;
        }
        button {
            padding: 10px 20px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #1565c0;
        }
        .status {
            padding: 10px;
            border-radius: 6px;
            margin: 10px 0;
        }
        .success {
            background: rgba(0, 212, 170, 0.2);
            color: #00D4AA;
            border: 1px solid #00D4AA;
        }
        .error {
            background: rgba(255, 107, 107, 0.2);
            color: #FF6B6B;
            border: 1px solid #FF6B6B;
        }
        .kline-demo {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        .kline-item {
            width: 20px;
            height: 60px;
            border: 1px solid #333;
            position: relative;
            background: #222;
        }
        .kline-body {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 12px;
            background: #00D4AA;
            border: 1px solid #00D4AA;
        }
        .kline-wick {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            width: 1px;
            background: #00D4AA;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ Kçº¿å›¾è°ƒè¯•æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>é—®é¢˜åˆ†æ</h2>
            <p>å½“å‰Kçº¿å›¾æ˜¾ç¤ºé—®é¢˜ï¼š</p>
            <ul>
                <li>âŒ æ˜¾ç¤ºçš„æ˜¯æŸ±çŠ¶å›¾ï¼Œä¸æ˜¯Kçº¿å›¾</li>
                <li>âŒ ç¼ºå°‘å¼€ç›˜ä»·ã€æœ€é«˜ä»·ã€æœ€ä½ä»·ã€æ”¶ç›˜ä»·çš„Kçº¿æ˜¾ç¤º</li>
                <li>âŒ è‡ªå®šä¹‰Kçº¿æ¸²æŸ“ç»„ä»¶å¯èƒ½æ²¡æœ‰æ­£ç¡®å·¥ä½œ</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>APIæ•°æ®æµ‹è¯•</h2>
            <button onclick="testAPI()">æµ‹è¯•APIæ•°æ®</button>
            <button onclick="generateKLineData()">ç”ŸæˆKçº¿æ•°æ®</button>
            <button onclick="clearData()">æ¸…ç©ºæ•°æ®</button>
            
            <div id="api-status" class="status">ç­‰å¾…æµ‹è¯•</div>
            <div id="data-display" class="data-display"></div>
        </div>

        <div class="test-section">
            <h2>Kçº¿å›¾æ¼”ç¤º</h2>
            <p>æ ‡å‡†Kçº¿å›¾åº”è¯¥æ˜¾ç¤ºï¼š</p>
            <div class="kline-demo" id="kline-demo">
                <!-- Kçº¿å›¾æ¼”ç¤ºå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>

        <div class="test-section">
            <h2>ç»„ä»¶è°ƒè¯•</h2>
            <div id="chart-container" class="chart-container">
                <div>
                    <h3>Kçº¿å›¾ç»„ä»¶è°ƒè¯•</h3>
                    <p>æ£€æŸ¥æ•°æ®æ ¼å¼å’Œæ¸²æŸ“é€»è¾‘</p>
                    <p><strong>å½“å‰çŠ¶æ€ï¼š</strong> <span id="chart-status">ç­‰å¾…æµ‹è¯•</span></p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let testData = [];

        async function testAPI() {
            try {
                updateStatus('æ­£åœ¨æµ‹è¯•API...', 'info');
                const response = await fetch('http://localhost:8000/market/price-chart?symbol=BTC-USDT&timeframe=1H&limit=24');
                const data = await response.json();
                
                if (data.success) {
                    testData = data.data;
                    displayData();
                    updateStatus('APIæ•°æ®è·å–æˆåŠŸï¼', 'success');
                    generateKLineDemo();
                } else {
                    updateStatus('APIè¿”å›å¤±è´¥: ' + data.message, 'error');
                }
            } catch (error) {
                updateStatus('APIè¯·æ±‚å¤±è´¥: ' + error.message, 'error');
            }
        }

        function generateKLineData() {
            testData = [];
            const basePrice = 95000;
            
            for (let i = 0; i < 12; i++) {
                const hour = (18 + i) % 24;
                const time = `${hour.toString().padStart(2, '0')}:00`;
                
                // ç”ŸæˆKçº¿æ•°æ®
                const open = basePrice + (Math.random() - 0.5) * 2000;
                const high = open + Math.random() * 1000;
                const low = open - Math.random() * 1000;
                const close = low + Math.random() * (high - low);
                const volume = 100 + Math.random() * 500;
                
                testData.push({
                    time: time,
                    open: Math.round(open),
                    high: Math.round(high),
                    low: Math.round(low),
                    close: Math.round(close),
                    volume: Math.round(volume),
                    timestamp: Date.now() + i * 3600000
                });
            }
            
            displayData();
            updateStatus('Kçº¿æ•°æ®å·²ç”Ÿæˆ', 'success');
            generateKLineDemo();
        }

        function displayData() {
            const dataDisplay = document.getElementById('data-display');
            dataDisplay.innerHTML = testData.map((item, index) => 
                `${index + 1}. ${item.time} - O:$${item.open} H:$${item.high} L:$${item.low} C:$${item.close} V:${item.volume}`
            ).join('<br>');
        }

        function generateKLineDemo() {
            const demoContainer = document.getElementById('kline-demo');
            demoContainer.innerHTML = '';
            
            testData.slice(0, 12).forEach((item, index) => {
                const klineDiv = document.createElement('div');
                klineDiv.className = 'kline-item';
                klineDiv.style.height = '80px';
                
                const isGreen = item.close >= item.open;
                const color = isGreen ? '#00D4AA' : '#FF6B6B';
                
                // è®¡ç®—Kçº¿ä½ç½®
                const prices = [item.open, item.high, item.low, item.close];
                const minPrice = Math.min(...prices);
                const maxPrice = Math.max(...prices);
                const range = maxPrice - minPrice;
                
                const bodyTop = ((maxPrice - Math.max(item.open, item.close)) / range) * 80;
                const bodyHeight = (Math.abs(item.close - item.open) / range) * 80;
                const wickTop = ((maxPrice - item.high) / range) * 80;
                const wickBottom = ((maxPrice - item.low) / range) * 80;
                
                // ä¸Šå½±çº¿
                const wickTopEl = document.createElement('div');
                wickTopEl.className = 'kline-wick';
                wickTopEl.style.top = wickTop + 'px';
                wickTopEl.style.height = (bodyTop - wickTop) + 'px';
                wickTopEl.style.background = color;
                klineDiv.appendChild(wickTopEl);
                
                // ä¸‹å½±çº¿
                const wickBottomEl = document.createElement('div');
                wickBottomEl.className = 'kline-wick';
                wickBottomEl.style.top = (bodyTop + bodyHeight) + 'px';
                wickBottomEl.style.height = (wickBottom - (bodyTop + bodyHeight)) + 'px';
                wickBottomEl.style.background = color;
                klineDiv.appendChild(wickBottomEl);
                
                // Kçº¿å®ä½“
                const bodyEl = document.createElement('div');
                bodyEl.className = 'kline-body';
                bodyEl.style.top = bodyTop + 'px';
                bodyEl.style.height = Math.max(bodyHeight, 1) + 'px';
                bodyEl.style.background = isGreen ? color : 'transparent';
                bodyEl.style.borderColor = color;
                klineDiv.appendChild(bodyEl);
                
                demoContainer.appendChild(klineDiv);
            });
        }

        function clearData() {
            testData = [];
            document.getElementById('data-display').innerHTML = '';
            document.getElementById('kline-demo').innerHTML = '';
            updateStatus('æ•°æ®å·²æ¸…ç©º');
        }

        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('api-status');
            statusElement.textContent = message;
            statusElement.className = 'status ' + type;
        }

        // åˆå§‹åŒ–
        updateStatus('ç­‰å¾…æµ‹è¯•');
    </script>
</body>
</html>
